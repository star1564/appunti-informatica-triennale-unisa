---
aliases: 
tags:
  - corsi/informatica/sistemi_operativi
paragrafo: Laboratorio SO
cssclasses:
  - 
---
La [[018 Strutture|struttura]] **stat** contiene le informazioni dettagliate di un file.

```C
struct stat {
	mode_t st_mode;    /* tipo di file e modalità (permessi) */
	ino_t st_ino;      /* numero i-node (numero seriale) */
	dev_t st_dev;      /* numero dispositivo (filesystem) */
	dev_t  st_rdev;    /* numero dispositivo per file speciali */
	nlink_t st_nlink;  /* numero di links */
	
	uid_t st_uid;      /* user ID del proprietario */
	gid_t st_gid;      /* group ID del proprietario */
	
	time_t st_atime;   /* tempo dell'ultimo accesso */
	time_t st_mtime;   /* tempo dell'ultima modifica */
	time_t st_ctime;   /* tempo dell'ultima modifica dello stato del file */
	
	off_t st_size;     /* dimensione in bytes, per file normali */
	long st_blksize;   /* migliore dimensione dei blocchi per I/O */
	long st_blocks;    /* quantità di blocchi (di 512 bytes) allocati */
};
```

La `st_mode` nella struttura stat include 9 bit che regolano i [[Permessi File|permessi]] di accesso al file.

---
### FUNZIONI
La **`stat()`**, **`fstat()`** e **`lstat()`** vengono usate per *ottenere informazioni su un file*.

```C
#include <sys/types.h>
#include <sys/stat.h>

int stat (const char *pathname, struct stat *buf);

int fstat (int fd, struct stat *buf);

int lstat (const char *pathname, struct stat *buf);
```

**Parametri**: 
- *`pathname`*: il path del file di cui si vogliono ottenere informazioni (si vede nella directory attuale se gli viene dato solo il nome del file);
	- *`fd`*: [[009 Apertura di un file#^8ad3ec|File Descriptor]];

- *`buf`*: struttura in cui vengono memorizzati i dati del file.

**Restituisce**:
- *0* se OK;
- Altrimenti *-1*.

**Differenze tra le funzioni**:
- *`stat()`*: inserisce nel secondo argomento una struttura di informazioni relative al file passato come primo argomento;
- *`fstat()`*: stessa cosa di `stat`, ma il file è già aperto, quindi si prende il suo file descriptor come primo argomento;
- *`lstat()`*: le informazioni ottenute sono relative al link simbolico (e non al file a cui esso si riferisce).

**Accesso ad i dati**:
Per accedere ai dati si utilizza l'*operatore punto*; per esempio *`buf.st_mode`* ritorna il tipo di file ottenuto.

> [!info] Queste funzioni sono usate soprattutto dal [[1001.L-SO Comandi Principali#^d01871|comando]] `ls -l`

---
### MACRO PER TIPI DI FILE
Le macro seguenti sono **funzioni booleane** che aiutano ad identificare il tipo di un file verificando ciò che è contenuto nel campo `st_mode` della struttura `stat`.

| Macro       | Tipo di File |
| ----------- | ------------ |
| `S_ISREG()` | File normale |
| `S_ISDIR()` | File directory |
| `S_ISCHR()` | File carattere speciale |
| `S_ISBLK()` | File blocco speciale |
| `S_ISFIFO()` | Pipe o FIFO |
| `S_ISLNK()` | Link simbolico |
| `S_ISSOCK()` | Socket |

> [!example]- <font color="orange">Esempio</font>
>```C
>#include <sys/types.h>
>#include <sys/stat.h>
>#include <stdio.h>
>
>int main(){	
>	struct stat buf;
>
>	if(stat("foo.txt", &buf) < 0){
>		printf("stat error\n");
>		return 0;
>	}
>
>	if(S_ISREG(buf.st_mode)) printf("Normale\n");
>	else if(S_ISDIR(buf.st_mode)) printf("Directory\n");
>	else if(S_ISCHR(buf.st_mode)) printf("Carattere Speciale\n");
>	else if(S_ISBLK(buf.st_mode)) printf("Blocco Speciale\n");	
>	return 0;
>}
>```

___
%%
Tag Materia: #corsi/informatica/sistemi_operativi 
%%
[[000 Indice SO|↖ Ritorna all'indice ↖]] , [[1002.L-SO Modifica Files|← Nota Precedente]] | [[1004.L-SO Accesso ai File|Nota Successiva →]]

Altri collegamenti: 
- [Struttura stat](https://www.mkssoftware.com/docs/man5/struct_stat.5.asp)
- [Funzioni stat](https://www.mkssoftware.com/docs/man3/stat.3.asp)