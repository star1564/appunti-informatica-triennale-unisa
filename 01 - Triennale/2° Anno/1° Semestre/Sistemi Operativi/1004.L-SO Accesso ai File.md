---
aliases:
  - access
  - chmod
tags:
  - corsi/informatica/sistemi_operativi
paragrafo: Laboratorio SO
cssclasses:
  - 
---
### ID DEI PROCESSI
Il campo **`st_uid`** e **`st_gid`** della [[1003.L-SO Stat|struttura stat]] contiene l'*ID* dell'utente (o del gruppo) che possiede il file.
- UID: User ID;
- GID: Group ID.

Ogni processo ha degli ID associati:
- *real ID*: è una **proprietà del file**, specifica chi è davvero l'utente o il gruppo (preso da `/etc/passwd` al login time);
- *effective ID*: è una **proprietà del processo che utilizza il file**, determina i permessi di accesso ai file;
- *saved set ID*: contengono copie dell'effective quando è eseguito un programma.

Normalmente il *campo effective è uguale al campo real*. 
Si può però settare un flag speciale (`S_ISUID` e `S_ISGID`) nel campo `st_mode` che imposti in un processo l'effective al proprietario del file eseguibile.

#### ALGORITMO DI ACCESSO AI FILE
- Se l'effective ID è 0:
	- *Accesso Libero*.
- Se l'effective ID è uguale all'ID dell'utente:
	- *Accesso in accordo ai permessi "User"*.
- Se l'effective ID è uguale all'ID del gruppo:
	- *Accesso in accordo ai permessi "Group"*.
- Altrimenti:
	- *Accesso in accordo ai permessi "Other"*.
---
### ACCESS
La **`access()`** viene usata per *verificare se il real ID può accedere ad un file*.

```C
#include <unistd.h>

int access (const char *pathname, int mode);
```

**Parametri**: 
- *`pathname`*: il path del file di cui si vuole verificare l'accesso (si vede nella directory attuale se gli viene dato solo il nome del file);

- *`mode`*: specifica i controlli di accessibilità da eseguire; questi sono quelli utilizzati: 

| *`mode`* | Descrizione                     |
| ------ | ------------------------------- |
| `R_OK` | Test per permessi di lettura    |
| `W_OK` | Test per permessi di scrittura  |
| `X_OK` | Test per permessi di esecuzione |
| `F_OK` | Test per esistenza del file     |

**Restituisce**:
-   _0_ se OK;
-   Altrimenti _-1_.

> [!example]- <font color="orange">Esempio</font>
>```C
>#include <sys/types.h>
>#include <unistd.h>
>#include <stdio.h>
>#include <sys/stat.h>
>#include <fcntl.h>
>
>int main(){	
>	if(open("foo.txt", O_RDONLY | O_CREAT) < 0) // Aperto solo per lettura
>		printf("Errore apertura file\n");
>
>	if(access("foo.txt", R_OK) < 0)
>		printf("Errore di accesso: Read\n");
>	else
>		printf("Accesso Read: OK\n");
>
>	if(access("foo.txt", W_OK) < 0)
>		printf("Errore di accesso: Write\n");
>	else
>		printf("Accesso Write: OK\n");		
>
>	return 0;
>}
>```

---
### CHMOD - FCHMOD

> [!warning] Questa funzione (ed anche il comando) funzionano solo su Linux
> I programmi compilano ed il comando viene eseguito, ma non avvengono i cambiamenti richiesti.
> A quanto pare Windows ha un sistema diverso per i permessi.

La **`chmode()`** viene usata per *AGGIORNARE i bit di permesso di un file*.

```C
#include <sys/types.h>
#include <sys/stat.h>

int chmod(const char *pathname, mode_t mode);
int fchmod(int fd, mode_t mode);
```

**Parametri**: 
- *`pathname`*: il path del file di cui si vuole cambiare l'accesso (si vede nella directory attuale se gli viene dato solo il nome del file);
	- *`fd`*: [[009 Apertura di un file#^8ad3ec|File Descriptor]];
- *`mode`*: il campo `st_mode` della `stat`.

**Restituisce**:
-   _0_ se OK;
-   Altrimenti _-1_.

**Differenze tra le funzioni**:
- *`chmod()`*: cambia il campo `st_mode` passato al secondo parametro del file passato come primo parametro;
- *`fchmod()`*: stessa cosa di `chmod()`, ma il file è già aperto, quindi si prende il suo file descriptor come primo argomento.

**Costanti per il mode**:
![[Pasted image 20221018153220.png|500]]

> [!example]- <font color="orange">Esempio Aggiornamento e Rimozione bit</font>
>```C
>#include <sys/types.h>
>#include <sys/stat.h>
>#include <fcntl.h>
>#include <unistd.h>
>#include <stdio.h>
>
>int main(){
>	struct stat buf;
>	
>	if(stat("foo.txt", &buf) < 0){
>		printf("Errore stat\n");
>		return 0;
>	}
>
>	// AGGIORNA I BIT DI PERMESSO DEL FILE
>	
>	// Aggiorna i permessi a: rw- r-- r--
>	if(chmod("foo.txt", S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH) < 0){
>		printf("Errore chmod 1\n");
>		return 0;
>	}
>
>	// RIMUOVE DEI BIT DI PERMESSI, necessita la strut
>
>	// Rimuove la lettura di Other, viene aggiornato a: rw- r-- ---
>	// ~ = Alt + 126 su windows
>	if(chmod("foo.txt", buf.st_mode & ~S_IROTH) < 0){
>		printf("Errore chmod 2\n");
>		return 0;	
>	}
>
>	return 0;
>}
>```


___
%%
Creato il 25/10/2022, 09:44
Tag Materia: #corsi/informatica/sistemi_operativi 
%%
[[000 Indice SO|↖ Ritorna all'indice ↖]] , [[1003.L-SO Stat|← Nota Precedente]] | [[1005.L-SO Directory|Nota Successiva →]]

Altri collegamenti: 